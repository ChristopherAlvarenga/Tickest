@using Microsoft.AspNetCore.Identity;
@using Tickest.Models.ViewModels;
@model TicketViewModel

@inject UserManager<IdentityUser> userManager

@{
    var user = await userManager.FindByEmailAsync(User.Identity.Name);

    if (await userManager.IsInRoleAsync(user, "Gerenciador"))
        Layout = "_LayoutGerenciador";

    else if (await userManager.IsInRoleAsync(user, "Responsavel"))
        Layout = "_LayoutResponsavel";

    else if (await userManager.IsInRoleAsync(user, "Desenvolvedor"))
        Layout = "_Layout";
}
<style>
.fa{
    color:red;

    font-size:20px;

    margin-left:3px;
}
.name{
    margin:3px;
        color: #696cff !important;
    }
</style>
<!-- Content wrapper -->
<div class="content-wrapper">
    <!-- Content -->
    <div class="container-xxl flex-grow-1 container-p-y">
        <div class="row">
            <form method="post" EncType="multipart/form-data">
                <!-- Basic -->
                <div class="col-md-6">
                    <div class="card mb-4">
                        <h5 class="card-header">Criação de Ticket</h5>
                        <div class="card-body demo-vertical-spacing demo-only-element">

                            <label asp-for="Ticket.Título" class="form-label" for="basic-default-password12">Título</label>
                            <div class="input-group">
                                <input asp-for="Ticket.Título" type="text"
                                       class="form-control"
                                       placeholder="Título"
                                       aria-label="Username"
                                       aria-describedby="basic-addon11" />
                            </div>

                            <label asp-for="Ticket.Prioridade" class="form-label" for="basic-default-password12">Prioridade</label>
                            <div class="input-group">
                                <div class="input-group">
                                    <select asp-for="Ticket.Prioridade" class="form-select" id="inputGroupSelect02">
                                        <option value="1" selected>Escolha...</option>
                                        <option value="1">Baixa</option>
                                        <option value="2">Média</option>
                                        <option value="3">Alta</option>
                                        <option value="4">Urgente</option>
                                    </select>
                                </div>
                            </div>

                            <label asp-for="Ticket.Descrição" class="form-label" for="basic-default-password12">Descrição</label>
                            <div class="input-group">
                                <textarea asp-for="Ticket.Descrição" class="form-control" aria-label="With textarea" placeholder="Descreva sua solicitação/problema"></textarea>
                            </div>

                            <label for="Ticket.DepartamentoId" class="form-label control-label">Departamento</label>
                            <div class="input-group form-group">
                                <div class="input-group form-group">
                                    <select asp-for="Ticket.DepartamentoId" id="Departamentos" class="form-select form-control">
                                        <option value="">Escolha...</option>
                                        @foreach (var departamento in ViewBag.Departamentos)
                                        {
                                            <option value="@departamento.Id">@departamento.Nome</option>
                                        }
                                    </select>
                                </div>
                            </div>

                            <label for="Ticket.AreaId" id="AreaLabel" class="form-label control-label" style="display:none">Área</label>
                            <div class="input-group form-group">
                                <select asp-for="Ticket.AreaId" asp-items="ViewBag.Areas" id="AreasDrop" class="form-select form-control" style="display:none"></select>
                            </div>

                            <div class="mb-3" id="anexos">
                                <label for="formFileMultiple" class="form-label">Anexos</label>
                                <br />


                                <div class="" id="files">
                                </div>

                                <button class="btn btn-success anexo mb-2" type="button">Adicionar anexo</button>
   
                                  
                              
                            </div>

                            <button type="submit" class="btn btn-primary mt-3">Criar Ticket</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        var id = 0;
        $(".anexo").click(function () {

            var input_id = "anexo-" + id;

            var html = '<input onchange=teste("' + input_id + '") id="anexo-' + id + '"hidden name="Ticket.Anexos[' + id + '].File" number ="' + id + '" class="form-control input-anexo" type = "file" />'

            $("#anexos").append(html);
            $("#anexo-"+id).click();
            id++;
        })
       
    });

    function teste(id){
        var filename = $("#"+id).val().replace(/.*(\/|\\)/, '');

      
        
        var html = '<a id="btn-'+id+'" type="button" anexo_id="' + id + '" class="name" >  ' + filename + '  <i onclick=remove("' + id + '")  class="fa fa-times" aria-hidden="true"></i></a>'
        $("#files").append(html);

    }

    function remove(id) {
        $("#" + id).remove();
        $("#btn-" + id).remove();
      
    }

    document.getElementById("Departamentos").addEventListener("change", function () {
        var DepId = this.value;

        // Recupera os elementos do segundo dropdown
        var Areas = document.getElementById("AreasDrop");

        // Limpa as opções existentes no segundo dropdown
        Areas.innerHTML = '<option value="">Escolha...</option>';

        // Exibe ou oculta o segundo dropdown com base na escolha no primeiro dropdown
        var AreaLabel = document.getElementById("AreaLabel");
        Areas.style.display = DepId ? "block" : "none";
        AreaLabel.style.display = DepId ? "block" : "none";

        // Adiciona as opções relevantes ao segundo dropdown
    @foreach (var area in Model.Areas)
    {
        <text>
                        if (DepId == "@area.DepartamentoId") {
                Areas.innerHTML += '<option value="@area.Id">@area.Nome</option>';
            }
        </text>
    }
        });

  
</script>
